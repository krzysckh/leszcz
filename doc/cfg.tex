\usepackage{fvextra, fontspec, newunicodechar}
\usepackage[margin=2cm]{geometry}
\usepackage{coffeestains}
\usepackage{everypage}
\usepackage{pgf}
\usepackage{pgf-umlsd}
\usepackage{float}
\usepackage{bytefield}
\usepackage{etoolbox}
\usepackage{epigraph}
\usepackage{emoji}

\renewcommand{\figurename}{Rysunek}

\setmainfont{LucidaGrande-Regular}[
  BoldFont = {LucidaGrande-Bold},
  ItalicFont = {LucidaGrande-Italic},
  BoldItalicFont = {LucidaGrande-BoldItalic}
]
\setmonofont{APL385 Unicode}

\DefineVerbatimEnvironment{Highlighting}{Verbatim}{breaklines,commandchars=\\\{\}}

\newfontfamily{\fallbackfont}{Apl385 Unicode}[Scale=MatchLowercase]
\DeclareTextFontCommand{\textfallback}{\fallbackfont}

\newunicodechar{→}{\textfallback{→}}
\newunicodechar{∆}{\textfallback{∆}}

\setlength\epigraphwidth{16cm}
\setlength\epigraphrule{0pt}

%% \makeatletter
%% \renewcommand\@epitext[1]{{\fontfamily{cmr}\selectfont #1}}
%% \makeatother

\usepackage{etoolbox}
\makeatletter
\newlength\epitextskip
\pretocmd{\@epitext}{\em}{}{}
\apptocmd{\@epitext}{\em}{}{}
\patchcmd{\epigraph}{\@epitext{#1}\\}{\@epitext{#1}\\[\epitextskip]}{}{}
\makeatother
